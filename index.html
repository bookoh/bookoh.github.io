<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BSBKTV | ë¦¬ì–¼íƒ€ì„ ë°©ì†¡êµ­</title>

  <!-- ë©”íƒ€ / OG -->
  <meta name="naver-site-verification" content="5ba7f1186b1e87736f411dc503245675bc0bda9f" />
  <meta property="og:title" content="BSBKTV | ë‹¤ì–‘í•œ ì°½ì‘ìì˜ ì¢‹ì€ ì½˜í…ì¸ ë¥¼ í•œê³³ì— ëª¨ì•„ ì„¸ìƒì´ë¼ëŠ” ì°½ì— ë¹„ì¶”ëŠ” ë°©ì†¡êµ­" />
  <meta property="og:description" content="ìœ íŠœë²„, ì‘ê°€, ìŠ¤ë ˆë“œ í¬ë¦¬ì—ì´í„°ì˜ ì½˜í…ì¸ ë¥¼ ëª¨ì•„ ì†Œê°œí•˜ê³  ì—°ê²°í•´ ì£¼ëŠ” íë ˆì´ì…˜ ë°©ì†¡ í”Œë«í¼ì…ë‹ˆë‹¤." />
  <meta property="og:image" content="https://bookoh.github.io/bsbktv/bsbktv-og.png">
  <meta property="og:url" content="https://bookoh.github.io/bsbktv/">

  <!-- GA -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LTYGXJRYKY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-LTYGXJRYKY');
  </script>

  <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- ìŠ¤íƒ€ì¼ -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;500;700;900&display=swap');
    *{box-sizing:border-box;}
    body{
      font-family:'Pretendard',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      background:#050505;color:#fff;
    }
    .neon-text{color:#00E5FF;text-shadow:0 0 15px rgba(0,229,255,0.5);}
    .video-card{
      background:#111;border-radius:16px;overflow:hidden;
      border:1px solid #222;transition:all .25s ease;cursor:pointer;
      min-width:260px;max-width:320px;
    }
    .video-card:hover{
      transform:translateY(-4px);
      border-color:#00E5FF;
      box-shadow:0 8px 24px rgba(0,229,255,0.18);
    }
    .loader{
      border:3px solid #333;border-top:3px solid #00E5FF;
      border-radius:50%;width:34px;height:34px;
      animation:spin 1s linear infinite;margin:40px auto;
    }
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .section-title{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;
    }
    .section-title h2{
      font-size:1.5rem;font-weight:900;
      background:linear-gradient(135deg,#00E5FF,#fff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .badge-live{
      background:#ff1744;color:#fff;font-size:11px;
      padding:4px 10px;border-radius:999px;font-weight:700;
    }
    .board-row{
      background:#111;border-radius:12px;padding:16px;
      border:1px solid #222;transition:all .2s;cursor:pointer;
    }
    .board-row:hover{
      background:#141414;border-color:#00E5FF;transform:translateX(4px);
    }
    .hero-subtitle{
      background:linear-gradient(135deg,#00E5FF,#667eea);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .row-scroll{
      display:flex;gap:16px;overflow-x:auto;
      padding-bottom:6px;-webkit-overflow-scrolling:touch;
      scroll-snap-type:x mandatory;
    }
    .row-scroll::-webkit-scrollbar{height:4px;}
    .row-scroll::-webkit-scrollbar-thumb{
      background:#333;border-radius:999px;
    }
    .row-item{scroll-snap-align:start;}
    .mobile-menu{
      position:fixed;inset:0;background:rgba(0,0,0,0.9);
      backdrop-filter:blur(10px);z-index:60;display:none;
    }
    .mobile-menu.active{display:block;}

    /* ë„¤ì´ë²„ ì¹´í˜í˜• ê²Œì‹œíŒ ì„ íƒ bottom sheet */
    .mobile-sheet {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.7);
      z-index:55;
      display:none;
    }
    .mobile-sheet.active { display:block; }
  </style>

  <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ê¸°ë³¸ ë³´í˜¸
    document.addEventListener('contextmenu',e=>e.preventDefault());
    document.addEventListener('keydown',e=>{
      if(e.key==='F12'||(e.ctrlKey&&(e.key==='U'||e.key==='S'))) e.preventDefault();
    });

    // Supabase í´ë¼ì´ì–¸íŠ¸ (ê³µìš©)
    const { createClient } = supabase;
    const SUPABASE_URL = 'https://dmjaxhydwaumhujrculd.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtamF4aHlkd2F1bWh1anJjdWxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MTEyNTgsImV4cCI6MjA4MDI4NzI1OH0.nTdfW9Iw3OLyYbWcPGU2T8P_i-9tDeqUn1t2cAsIbn0';
    const db = createClient(SUPABASE_URL, SUPABASE_KEY); /* [web:301][web:289] */

    const THREAD_RECOMMENDED_URLS = [
      'https://youtu.be/4Ux6KUF77fA',
      'https://youtu.be/BbMkoRuxLqc',
      'https://youtu.be/vYSsPeHKmP8',
      'https://youtu.be/_VR9N2HN8Ik',
      'https://youtu.be/yw7FkHo6_qQ',
      'https://youtu.be/crHHvBDi698',
      'https://youtu.be/D1JNCyvPvzo'
    ];

    const CATEGORIES = [
      { key:'k-variety', label:'í•œêµ­ì˜ˆëŠ¥', spotTypes:['ë¨¹ë°©','ì˜ˆëŠ¥/í† í¬'] },
      { key:'news',      label:'ë‰´ìŠ¤',     spotTypes:['ë‰´ìŠ¤','ì‹œì‚¬Â·ê²½ì œ'] },
      { key:'ytlive',   label:'ìœ íŠœë¸Œ ë¼ì´ë¸Œ',     spotTypes:['ìœ íŠœë¸Œ ë¼ì´ë¸Œ'] },
      { key:'today',     label:'ì˜¤ëŠ˜ì˜ ë°œê²¬', spotTypes:['ì˜¤ëŠ˜ì˜ ë°œê²¬','ê²½ì œÂ·í…Œí¬','AI/ì½˜í…ì¸ '] },
      { key:'k-movie',   label:'í•œêµ­ì˜í™”', spotTypes:['ì˜í™”'] },
      { key:'smallbiz',  label:'ì†Œìƒê³µì¸', spotTypes:['ì†Œìƒê³µì¸'] },
      { key:'writer',    label:'ì‘ê°€',     spotTypes:['ë¶í† í¬/ë‚­ë…'] },
      { key:'ai-video',  label:'AI ì˜ìƒ',  spotTypes:['AI/ì½˜í…ì¸ '] },
      { key:'threads',   label:'ìŠ¤ë ˆë“œ ì¶”ì²œ ìœ íŠœë²„', spotTypes:['ìŠ¤ë ˆë“œ ì¶”ì²œ ìœ íŠœë²„'] }
    ];

    async function loadChzzkStreams() {
      const { data, error } = await db
        .from('chzzk_streams')
        .select('id, live_url, spot_id, spots(*)');
      if (error) {
        console.error('loadChzzkStreams error', error);
        return;
      }
      console.log('chzzk_streams', data);
    }

    const SLOT_TYPES_BY_CATEGORY = {
      writer: 'writer',
      today:  'today'
    };

    function affiliateButtonsHtml(spot, slotType) {
      if (!spot.affiliate_buttons || !spot.affiliate_buttons.length) return '';
      const filtered = slotType
        ? spot.affiliate_buttons.filter(b => (b.slot_type || 'writer') === slotType)
        : spot.affiliate_buttons;
      if (!filtered.length) return '';
      return `
        <div class="mt-2 px-4 pb-4 space-y-2">
          <p class="text-[10px] text-gray-500 text-center">
            ${filtered[0]?.provider === 'oliveyoung'
              ? 'í•´ë‹¹ ë§í¬ëŠ” ì˜¬ë¦¬ë¸Œì˜ ì œíœ´ ë§í¬ë¡œ, êµ¬ë§¤ ì‹œ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.'
              : 'ì´ ë§í¬ë¥¼ í†µí•´ êµ¬ë§¤ ì‹œ, ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ìœ¼ë¡œ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.'}
          </p>
          ${filtered.map(btn => `
            <button
              class="w-full flex items-center justify-center gap-2 rounded-full py-2 text-xs font-semibold
                     bg-gradient-to-r from-orange-500 to-blue-600 hover:brightness-110 transition"
              onclick="handleAffiliateClick(${btn.id}, '${btn.url.replace(/'/g,"\\'")}', '${btn.provider}')"
            >
              ${btn.logo_url ? `<img src="${btn.logo_url}" class="h-4 w-4 object-contain" alt="">` : ''}
              <span>${btn.label}</span>
            </button>
          `).join('')}
        </div>
      `;
    }

    function cardHtml(spot, slotTypeForThisCategory){
      const dateStr = spot.created_at
        ? new Date(spot.created_at).toLocaleDateString('ko-KR')
        : '';
      const badge = spot.is_top10
        ? `<span class="badge-live px-2 py-1 text-xs">TOP ${spot.top10_rank ?? ''}</span>`
        : '';
      const affiliateHtml = affiliateButtonsHtml(spot, slotTypeForThisCategory);

      return `
        <div class="row-item">
          <div class="video-card block" onclick='openPlayer(${JSON.stringify({
            id: spot.id,
            video_url: spot.video_url
          }).replace(/'/g, "\\'")})'>
            <div class="aspect-video overflow-hidden relative">
              <img src="${spot.thumb_url}" alt="${spot.name}"
                   class="w-full h-full object-cover hover:scale-105 transition">
              <div class="absolute top-2 right-2">
                ${badge}
              </div>
            </div>
            <div class="p-4 pb-2">
              <h3 class="font-bold text-sm leading-tight line-clamp-2 mb-2">${spot.name}</h3>
              <div class="flex items-center text-xs text-gray-500 gap-3">
                <span>${spot.type ?? ''}</span>
                <span>${dateStr}</span>
              </div>
            </div>
            ${affiliateHtml}
          </div>
        </div>
      `;
    }

    async function handleAffiliateClick(buttonId, url, provider){
      try{
        await db.from('affiliate_clicks').insert({
          button_id: buttonId,
          provider,
          clicked_at: new Date().toISOString()
        });
      }catch(e){
        console.error(e);
      }
      window.open(url, '_blank');
    }

    async function loadNotices(){
      const { data,error } = await db
        .from('notices')
        .select('id,title,content,created_at')
        .order('created_at',{ascending:false})
        .limit(5);
      if(error) console.error(error);
      else displayBoard('notices-container',data||[],'ê³µì§€');
    }

    async function loadFreeBoard(){
      const { data,error } = await db
        .from('board')
        .select('id,title,content,created_at')
        .order('created_at',{ascending:false})
        .limit(5);
      if(error) console.error(error);
      else displayBoard('freeboard-container',data||[],'ììœ ê²Œì‹œíŒ');
    }

    async function loadQA(){
      const { data,error } = await db
        .from('qa')
        .select('id,title,content,created_at')
        .order('created_at',{ascending:false})
        .limit(5);
      if(error) console.error(error);
      else displayBoard('qa-container',data||[],'Q&A');
    }

    async function loadVideos(){
      const { data,error } = await db
        .from('spots')
        .select('*, affiliate_buttons(*)')
        .order('created_at',{ascending:false});
      if(error){ console.error(error); return; }

      const spots = data || [];
      const topSpots = spots
        .filter(s => s.is_top10 === true)
        .sort((a,b)=>(a.top10_rank||999)-(b.top10_rank||999))
        .slice(0,10);
      displayTop10(topSpots);

      window.__allSpots = spots;
      renderCategorySections();
    }

    function displayTop10(spots){
      const container = document.getElementById('top10-container');
      container.innerHTML = '';
      if(!spots || spots.length===0){
        container.innerHTML = '<div class="text-gray-500 text-sm py-6">ë“±ë¡ëœ TOP 10 ë°©ì†¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      container.innerHTML = spots.map(s => cardHtml(s, null)).join('');
    }

    function renderCategorySections(){
      const container = document.getElementById('sections-container');
      const spots = window.__allSpots || [];

      container.innerHTML = CATEGORIES.map(cat=>{
        let catSpots;
        if(cat.key==='threads'){
          catSpots = spots.filter(s =>
            (s.type==='ìŠ¤ë ˆë“œ ì¶”ì²œ ìœ íŠœë²„') ||
            THREAD_RECOMMENDED_URLS.includes((s.video_url||'').trim())
          );
        }else{
          catSpots = spots.filter(s => (cat.spotTypes||[]).includes(s.type));
        }
        if(!catSpots.length) return '';

        const slotType = SLOT_TYPES_BY_CATEGORY[cat.key] || null;
        const cardsHtml = catSpots.map(s => cardHtml(s, slotType)).join('');

        const isWriter = cat.key === 'writer';
        const isToday  = cat.key === 'today';

        return `
          <section class="mt-10">
            <div class="section-title">
              <h2>${cat.label}</h2>
            </div>

            ${isWriter ? `
              <p class="text-[11px] text-gray-500 mb-1">
                ì´ í¬ìŠ¤íŒ…ì€ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, ì´ì— ë”°ë¥¸ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
              </p>
              <p class="text-[11px] text-gray-500 mb-2">
                ì´ í¬ìŠ¤íŒ…ì€ ì˜¬ë¦¬ë¸Œì˜ ì‡¼í•‘ íë ˆì´í„° í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, êµ¬ë§¤ ì‹œ ì¼ì • ê¸ˆì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
              </p>
            ` : ''}

            ${isToday ? `
              <p class="text-[11px] text-gray-500 mb-1">
                ì´ í¬ìŠ¤íŒ…ì€ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, ì´ì— ë”°ë¥¸ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
              </p>
              <p class="text-[11px] text-gray-500 mb-2">
                ì´ í¬ìŠ¤íŒ…ì€ ì˜¬ë¦¬ë¸Œì˜ ì‡¼í•‘ íë ˆì´í„° í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, êµ¬ë§¤ ì‹œ ì¼ì • ê¸ˆì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
              </p>
            ` : ''}

            <div class="row-scroll">
              ${cardsHtml}
            </div>
          </section>
        `;
      }).join('');
    }

    function extractYouTubeId(url) {
      if (!url) return null;
      try {
        if (url.includes('youtu.be/')) {
          return url.split('youtu.be/')[1].split(/[?&]/)[0];
        }
        const u = new URL(url);
        if (u.searchParams.get('v')) {
          return u.searchParams.get('v');
        }
        if (url.includes('/embed/')) {
          return url.split('/embed/')[1].split(/[?&]/)[0];
        }
      } catch (e) {
        console.error('extractYouTubeId error', e);
      }
      return null;
    }

    function openPlayer(spot) {
      const videoId = extractYouTubeId(spot.video_url || '');
      if (!videoId) {
        console.error('Invalid video_url', spot.video_url);
        return;
      }
      const player = document.getElementById('player-iframe');
      player.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;

      const overlay = document.getElementById('player-overlay');
      overlay.classList.remove('hidden');
      overlay.classList.add('flex');
    }

    function closePlayer() {
      const overlay = document.getElementById('player-overlay');
      const player = document.getElementById('player-iframe');
      overlay.classList.add('hidden');
      overlay.classList.remove('flex');
      player.src = '';
    }

    function displayBoard(containerId,items,boardType){
      const container = document.getElementById(containerId);
      container.innerHTML =
        (items||[]).map(item=>`
          <div class="board-row group">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-sm line-clamp-1 group-hover:text-[#00E5FF]">${item.title}</h4>
              <span class="text-xs text-gray-500">
                ${item.created_at ? new Date(item.created_at).toLocaleDateString('ko-KR') : ''}
              </span>
            </div>
            <p class="text-xs text-gray-400 line-clamp-2">${item.content}</p>
          </div>
        `).join('') ||
        `<div class="text-center py-12 text-gray-500">ì•„ì§ ${boardType} ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    }

    function toggleMobileMenu(open){
      const menu = document.getElementById('mobile-menu');
      if(open) menu.classList.add('active');
      else menu.classList.remove('active');
    }

    window.addEventListener('load', async () => {
      const loader = document.getElementById('loader');
      if (loader) loader.style.display = 'block';

      try {
        await Promise.all([
          loadVideos(),
          loadNotices(),
          loadFreeBoard(),
          loadQA(),
          loadChzzkStreams()
        ]);
      } catch (e) {
        console.error('load error >>>', e);
      } finally {
        if (loader) loader.style.display = 'none';
      }
    });
  </script>
</head>

<body class="min-h-screen">
  <!-- ëª¨ë°”ì¼ ë©”ë‰´ -->
  <div id="mobile-menu" class="mobile-menu">
    <div class="max-w-7xl mx-auto px-4 pt-6 flex justify-between items-center">
      <span class="text-2xl font-black">BSBK<span class="neon-text">TV</span></span>
      <button onclick="toggleMobileMenu(false)" class="p-2 text-gray-300">
        <i class="fas fa-times text-2xl"></i>
      </button>
    </div>
    <div class="mt-8 px-6 space-y-8">
      <div class="bg-[#111] border border-[#222] rounded-2xl p-5">
        <p class="text-sm text-[#00E5FF] font-semibold mb-2">WELCOME TO BSBKTV</p>
        <p class="text-sm leading-relaxed text-gray-200">
          ì—¬ê¸°ì„œëŠ” ì•Œê³ ë¦¬ì¦˜ì´ ì•„ë‹ˆë¼ í¸ì„± ë””ë ‰í„°ê°€ ê²°ì •í•©ë‹ˆë‹¤.<br>
          ì˜¤ëŠ˜ í•˜ë£¨, ë‹¹ì‹ ì˜ ì‹œê°„ì„ ì¨ë³¼ ë§Œí•œ ì˜ìƒê³¼ ì´ì•¼ê¸°ë§Œ ì—„ì„ í•´ì„œ ë‚´ë³´ëƒ…ë‹ˆë‹¤.
        </p>
      </div>

      <nav class="space-y-4 text-lg">
        <a href="#top10" onclick="toggleMobileMenu(false)" class="block text-white font-semibold">
          ğŸ¬ BSBKTV TOP 10
        </a>
        <a href="#sections-container" onclick="toggleMobileMenu(false)" class="block text-gray-200">
          ğŸ“º ì¹´í…Œê³ ë¦¬ í¸ì„±í‘œ
        </a>
        <a href="#notices" onclick="toggleMobileMenu(false)" class="block text-gray-200">
          ğŸ“¢ ê³µì§€ì‚¬í•­
        </a>
        <a href="#community" onclick="toggleMobileMenu(false)" class="block text-gray-200">
          ğŸ’¬ ì»¤ë®¤ë‹ˆí‹° & ì±…Â·ì†Œìƒê³µì¸ ì†Œê°œ
        </a>
        <a href="#qa" onclick="toggleMobileMenu(false)" class="block text-gray-200">
          â“ Q&A
        </a>
      </nav>

      <div class="mt-8 grid grid-cols-3 gap-3 text-xs">
        <a href="mailto:maple3589@gmail.com"
           class="flex flex-col items-center justify-center rounded-xl py-3 bg-gradient-to-b from-[#00E5FF] to-[#007F8C] text-black font-semibold">
          <i class="fas fa-handshake mb-1"></i>
          í˜‘ì—… ë¬¸ì˜
        </a>
        <a href="#sponsor-area"
           onclick="toggleMobileMenu(false)"
           class="flex flex-col items-center justify-center rounded-xl py-3 bg-gradient-to-b from-[#FFEA00] to-[#FF9800] text-black font-semibold">
          <i class="fas fa-ad mb-1"></i>
          ìŠ¤í°ì„œ ì•ˆë‚´
        </a>
        <a href="https://www.threads.net" target="_blank" rel="noopener noreferrer"
           class="flex flex-col items-center justify-center rounded-xl py-3 bg-gradient-to-b from-[#7C4DFF] to-[#311B92] text-white font-semibold">
          <i class="fas fa-user-astronaut mb-1"></i>
          Threads
        </a>
      </div>
    </div>
  </div>

  <!-- í—¤ë” -->
  <header class="fixed top-0 inset-x-0 bg-black/95 backdrop-blur-xl z-50 border-b border-gray-800/50">
    <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <span class="text-3xl font-black tracking-tighter">BSBK<span class="neon-text">TV</span></span>
        <span class="badge-live flex items-center gap-1">
          <span class="w-2 h-2 rounded-full bg-white animate-pulse"></span>
          ON AIR
        </span>
      </div>
      <nav class="hidden lg:flex items-center gap-6 text-sm text-gray-300">
        <a href="#top10" class="hover:text-white transition-all duration-200 relative group">
          TOP10
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#00E5FF] group-hover:w-full transition-all duration-300"></span>
        </a>
        <a href="#sections-container" class="hover:text-white transition-all duration-200 relative group">
          ì¹´í…Œê³ ë¦¬ í¸ì„±
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#00E5FF] group-hover:w-full transition-all duration-300"></span>
        </a>
        <a href="#notices" class="hover:text-white transition-all duration-200 relative group">
          ê³µì§€ì‚¬í•­
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#00E5FF] group-hover:w-full transition-all duration-300"></span>
        </a>
        <a href="#community" class="hover:text-white transition-all duration-200 relative group">
          ì»¤ë®¤ë‹ˆí‹°
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#00E5FF] group-hover:w-full transition-all duration-300"></span>
        </a>
        <a href="#qa" class="hover:text-white transition-all duration-200 relative group">
          Q&A
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#00E5FF] group-hover:w-full transition-all duration-300"></span>
        </a>
      </nav>
      <div class="flex items-center gap-3">
        <a href="mailto:maple3589@gmail.com"
           class="hidden md:block bg-gradient-to-r from-[#00E5FF] to-[#667eea] text-black text-xs font-bold px-6 py-2 rounded-full transition-all hover:scale-105 shadow-lg">
          <i class="fas fa-broadcast-tower mr-1"></i>ì…ì  ë¬¸ì˜
        </a>
        <button class="lg:hidden p-2 text-gray-400 hover:text-white" onclick="toggleMobileMenu(true)">
          <i class="fas fa-bars text-xl"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- ë©”ì¸ -->
  <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto">
    <section class="mb-12 text-center">
      <h1 class="text-5xl md:text-6xl font-black tracking-tight mb-6">
        BSBK<span class="neon-text">TV</span>
      </h1>
      <p class="hero-subtitle text-xl md:text-2xl mb-8 max-w-2xl mx-auto leading-relaxed">
        ë‹¤ì–‘í•œ ì°½ì‘ìì˜ ì¢‹ì€ ì½˜í…ì¸ ë¥¼ í•œê³³ì— ëª¨ì•„ ì„¸ìƒì´ë¼ëŠ” ì°½ì— ë¹„ì¶”ëŠ” ë°©ì†¡êµ­.
      </p>
    </section>

    <div id="loader" class="loader hidden"></div>

    <section id="top10" class="mb-12">
      <div class="section-title">
        <h2>ğŸ¬ BSBKTV TOP 10</h2>
      </div>
      <div id="top10-container" class="row-scroll"></div>
    </section>

    <div id="sections-container"></div>

    <section id="sponsor-area" class="mt-16">
      <div class="section-title">
        <h2><i class="fas fa-bullseye text-[#FFEA00] mr-3"></i>ìŠ¤í°ì„œ & ê´‘ê³ </h2>
      </div>
      <div class="grid md:grid-cols-3 gap-4 text-sm">
        <div class="bg-[#111] border border-dashed border-[#444] rounded-2xl p-4 flex flex-col justify-between">
          <div>
            <p class="font-semibold mb-1">ë©”ì¸ TOP10 ìŠ¤í°ì„œ</p>
            <p class="text-gray-400 text-xs">
              BSBKTV TOP10 ìƒë‹¨ì— ë¸Œëœë“œ ë…¸ì¶œ. ë‹¨ì¼/ê¸°ê°„ í•œì • ê´‘ê³  ë¬¸ì˜ëŠ” ì´ë©”ì¼ë¡œ ë°›ìŠµë‹ˆë‹¤.
            </p>
          </div>
          <p class="mt-3 text-xs text-gray-500">ë¬¸ì˜: maple3589@gmail.com</p>
        </div>
        <div class="bg-[#111] border border-dashed border-[#444] rounded-2xl p-4 flex flex-col justify-between">
          <div>
            <p class="font-semibold mb-1">ì„¹ì…˜ ì „ìš© ìŠ¤í°ì„œ</p>
            <p class="text-gray-400 text-xs">
              í•œêµ­ì˜ˆëŠ¥Â·ì±…Â·ì†Œìƒê³µì¸ ì„¹ì…˜ ìƒë‹¨ì— ë°°ë„ˆ ë˜ëŠ” ì¹´ë“œ í˜•íƒœë¡œ í˜‘ì—… ê°€ëŠ¥.
            </p>
          </div>
          <p class="mt-3 text-xs text-gray-500">ì½˜ì…‰íŠ¸ ë§ì¶¤ ì œì•ˆ í™˜ì˜.</p>
        </div>
        <div class="bg-[#111] border border-dashed border-[#444] rounded-2xl p-4 flex flex-col justify-between">
          <div>
            <p class="font-semibold mb-1">ë§ì¶¤ í¸ì„± í˜‘ì—…</p>
            <p class="text-gray-400 text-xs">
              ë¸Œëœë“œÂ·í¬ë¦¬ì—ì´í„° ì „ìš© ì±„ë„ í¸ì„±, AI ì˜ìƒ ì œì‘ê¹Œì§€ íŒ¨í‚¤ì§€ë¡œ ì§„í–‰ ê°€ëŠ¥.
            </p>
          </div>
          <a href="https://chzzk.naver.com/live/f22798612d8f1ecf32c0f51e381d12a7"
             target="_blank"
             class="mt-3 inline-flex items-center justify-center text-xs font-semibold text-black bg-[#00E5FF] px-3 py-2 rounded-full">
            BSBKTV ì¹˜ì§€ì§ ë¼ì´ë¸Œ ë³´ëŸ¬ê°€ê¸°
          </a>
        </div>
      </div>
    </section>

    <section id="notices" class="mt-24">
      <div class="section-title">
        <h2><i class="fas fa-bullhorn text-[#00E5FF] mr-3"></i>ê³µì§€ì‚¬í•­</h2>
      </div>
      <div id="notices-container" class="space-y-3"></div>
    </section>

    <!-- ê²Œì‹œíŒ ë©”ì‹œì§€ -->
    <div id="board-message" class="text-sm text-center mt-4"></div>

    <!-- ì»¤ë®¤ë‹ˆí‹° / ê²Œì‹œíŒ ëª©ë¡ -->
    <section id="community" class="mt-10">
      <div class="section-title">
        <h2><i class="fas fa-comments text-[#00E5FF] mr-3"></i>ì»¤ë®¤ë‹ˆí‹°</h2>
      </div>
      <div class="grid md:grid-cols-2 gap-8">
        <div>
          <h3 class="text-lg font-bold mb-6 flex items-center gap-2">
            <i class="fas fa-feather text-[#00E5FF]"></i>ììœ ê²Œì‹œíŒ (ì±…Â·ì†Œìƒê³µì¸Â·ì—ì„¸ì´)
          </h3>
          <div id="freeboard-container" class="space-y-3 max-h-96 overflow-y-auto"></div>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-6 flex items-center gap-2">
            <i class="fas fa-question-circle text-[#00E5FF]"></i>Q&A
          </h3>
          <div id="qa-container" class="space-y-3 max-h-96 overflow-y-auto"></div>
        </div>
      </div>
    </section>

    <!-- ======================= -->
    <!--  ë„¤ì´ë²„ ì¹´í˜í˜• ê¸€ì“°ê¸°  -->
    <!-- ======================= -->
    <section class="mt-10 max-w-xl mx-auto">
      <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
        <i class="fas fa-pen text-[#00E5FF]"></i>ê¸€ì“°ê¸°
      </h3>

      <!-- ê²Œì‹œíŒ ì„ íƒ ë²„íŠ¼ -->
      <button id="board-select-btn"
              class="w-full flex justify-between items-center border border-gray-700 px-3 py-2 rounded bg-black text-white">
        <span id="board-selected-label" class="text-sm text-gray-300">
          ê²Œì‹œíŒì„ ì„ íƒí•˜ì„¸ìš”
        </span>
        <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
      </button>

      <!-- ê²Œì‹œíŒ ì„ íƒ bottom sheet -->
      <div id="board-sheet" class="mobile-sheet">
        <div class="absolute inset-x-0 bottom-0 bg-[#111] rounded-t-2xl p-4
                    max-h-[75vh] overflow-y-auto">
          <div class="flex justify-between items-center mb-3">
            <h2 class="text-base font-semibold">ê²Œì‹œíŒ ì„ íƒ</h2>
            <button id="board-sheet-close" class="text-gray-400 text-xl">&times;</button>
          </div>

          <input id="board-search" type="text"
                 placeholder="ê²Œì‹œíŒ ê²€ìƒ‰"
                 class="w-full mb-3 px-3 py-2 rounded bg-black text-sm text-white border border-gray-700" />

          <div class="mb-2 text-xs text-gray-500">ì „ì²´ ê²Œì‹œíŒ</div>
          <div id="board-list" class="space-y-1 text-sm">
            <!-- JS ë¡œë”© -->
          </div>

          <button id="board-confirm"
                  class="mt-4 w-full py-2 rounded bg-blue-500 text-white text-sm font-semibold">
            ì„ íƒ ì™„ë£Œ
          </button>
        </div>
      </div>

      <!-- ê¸€ì“°ê¸° í¼ (í†µí•© posts í…Œì´ë¸”) -->
      <form id="post-form" class="mt-4 space-y-3">
        <input id="nickname" type="text" placeholder="ë‹‰ë„¤ì„ (ì„ íƒ)"
               class="w-full border border-gray-700 px-3 py-2 rounded bg-black text-white text-sm" />
        <input id="post-title" type="text" placeholder="ì œëª©"
               class="w-full border border-gray-700 px-3 py-2 rounded bg-black text-white" />
        <textarea id="post-content" rows="6" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."
                  class="w-full border border-gray-700 px-3 py-2 rounded bg-black text-white text-sm"></textarea>
        <button type="button" id="post-submit"
                class="w-full bg-blue-500 text-white py-2 rounded font-semibold">
          ë“±ë¡í•˜ê¸°
        </button>
        <p id="post-message" class="text-center text-xs text-gray-400 mt-1"></p>
      </form>
    </section>

    <!-- í†µí•© ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ (boards + posts + comments + likes) -->
    <section id="posts-area" class="mt-10 max-w-2xl mx-auto">
      <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
        <i class="fas fa-stream text-[#00E5FF]"></i>ìµœì‹  ê²Œì‹œê¸€
      </h3>
      <div id="posts-list" class="space-y-4">
        <p class="text-sm text-gray-500">ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
    </section>

    <!-- ë™ì˜ìƒ í”Œë ˆì´ì–´ ëª¨ë‹¬ -->
    <div id="player-overlay"
         class="fixed inset-0 bg-black/80 backdrop-blur-sm z-20 hidden items-center justify-center">
      <div class="relative w-full max-w-4xl mx-4">
        <button onclick="closePlayer()"
                class="absolute -top-10 right-0 text-gray-300 hover:text-white text-2xl">
          âœ•
        </button>
        <div class="w-full aspect-video bg-black rounded-2xl overflow-hidden">
          <iframe id="player-iframe"
                  class="w-full h-full"
                  src=""
                  title="BSBKTV Player"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </main>

  <!-- í‘¸í„° -->
  <footer class="bg-black/80 border-t border-gray-800 py-12 mt-24">
    <div class="max-w-7xl mx-auto px-4 text-center text-gray-400 text-sm space-y-4">
      <div class="flex flex-col md:flex-row gap-8 justify-center items-center">
        <div class="flex items-center gap-6">
          <a href="terms.pdf" target="_blank" class="hover:text-[#00E5FF] transition">ì´ìš©ì•½ê´€</a>
          <a href="privacy.pdf" target="_blank" class="hover:text-[#00E5FF] transition">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
          <a href="#sponsor-area" class="hover:text-[#00E5FF] transition">ìŠ¤í°ì„œ ì•ˆë‚´</a>
          <a href="#sections-container" class="hover:text-[#00E5FF] transition">í¸ì„±í‘œ</a>
        </div>
        <div>
          <p>BSBKTV Â© 2025. All rights reserved.</p>
          <p class="text-xs">ë¬¸ì˜: maple3589@gmail.com</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- ê¸°ì¡´ ììœ ê²Œì‹œíŒ ì‘ì„± í¼ ìŠ¤í¬ë¦½íŠ¸ + í†µí•© ì»¤ë®¤ë‹ˆí‹° ìŠ¤í¬ë¦½íŠ¸ -->
  <script type="module">
    const { createClient } = window.supabase;
    const supabaseUrl = 'https://dmjaxhydwaumhujrculd.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtamF4aHlkd2F1bWh1anJjdWxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MTEyNTgsImV4cCI6MjA4MDI4NzI1OH0.nTdfW9Iw3OLyYbWcPGU2T8P_i-9tDeqUn1t2cAsIbn0';
    const sb = createClient(supabaseUrl, supabaseKey); /* [web:301] */

    // ----------------- ê¸°ì¡´ ììœ ê²Œì‹œíŒ í¼ (board í…Œì´ë¸”ìš©, ê·¸ëŒ€ë¡œ ìœ ì§€) -----------------
    const legacyForm = document.getElementById('board-form');
    const legacyTitleInput = document.getElementById('board-title');
    const legacyContentInput = document.getElementById('board-content');
    const legacyButton = legacyForm.querySelector('button');
    const legacyMessage = document.getElementById('board-message');

    legacyButton.addEventListener('click', async () => {
      const title = legacyTitleInput.value.trim();
      const content = legacyContentInput.value.trim();

      if (!title || !content) {
        legacyMessage.textContent = 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
        return;
      }

      legacyButton.disabled = true;
      legacyMessage.textContent = 'ì‘ì„± ì¤‘...';

      const { error } = await sb
        .from('board')
        .insert({ title, content });

      if (error) {
        console.error(error);
        legacyMessage.textContent = 'ì‘ì„± ì‹¤íŒ¨: ' + error.message;
        legacyButton.disabled = false;
        return;
      }

      legacyMessage.textContent = 'ì‘ì„± ì™„ë£Œ!';
      legacyTitleInput.value = '';
      legacyContentInput.value = '';
      legacyButton.disabled = false;

      try {
        const { data, error: loadError } = await sb
          .from('board')
          .select('id,title,content,created_at')
          .order('created_at',{ascending:false})
          .limit(5);
        if (!loadError) {
          displayBoard('freeboard-container', data || [], 'ììœ ê²Œì‹œíŒ');
        }
      } catch(e){
        console.error(e);
      }
    });

    // ----------------- í†µí•© ì»¤ë®¤ë‹ˆí‹°: boards / posts / comments / likes -----------------
    let boards = [];
    let selectedBoardId = null;

    const boardBtn = document.getElementById('board-select-btn');
    const boardLabel = document.getElementById('board-selected-label');
    const boardSheet = document.getElementById('board-sheet');
    const boardClose = document.getElementById('board-sheet-close');
    const boardSearch = document.getElementById('board-search');
    const boardListEl = document.getElementById('board-list');
    const boardConfirm = document.getElementById('board-confirm');

    const nicknameInput = document.getElementById('nickname');
    const postTitleInput = document.getElementById('post-title');
    const postContentInput = document.getElementById('post-content');
    const postSubmitBtn = document.getElementById('post-submit');
    const postMsg = document.getElementById('post-message');
    const postsList = document.getElementById('posts-list');

    async function loadBoards() {
      const { data, error } = await sb
        .from('boards')
        .select('id, name, emoji')
        .order('id');
      if (error) {
        console.error(error);
        return;
      }
      boards = data || [];
      renderBoardList();
    }

    function renderBoardList(keyword = '') {
      const q = keyword.trim().toLowerCase();
      boardListEl.innerHTML = boards
        .filter(b => !q || (b.name || '').toLowerCase().includes(q))
        .map(b => `
          <label class="flex items-center justify-between px-2 py-2 rounded hover:bg-[#191919] cursor-pointer">
            <span class="flex items-center gap-2 text-sm">
              <span>${b.emoji || ''}</span>
              <span>${b.name}</span>
            </span>
            <input type="radio" name="board-radio2" value="${b.id}"
                   class="w-4 h-4 accent-[#00E5FF]"
                   ${b.id === selectedBoardId ? 'checked' : ''}>
          </label>
        `).join('') || `
          <p class="text-xs text-gray-500 px-1 py-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        `;
    }

    boardBtn.addEventListener('click', () => {
      boardSheet.classList.add('active');
    });
    boardClose.addEventListener('click', () => {
      boardSheet.classList.remove('active');
    });
    boardSearch.addEventListener('input', e => {
      renderBoardList(e.target.value);
    });

    boardConfirm.addEventListener('click', () => {
      const checked = boardListEl.querySelector('input[name="board-radio2"]:checked');
      if (!checked) {
        alert('ê²Œì‹œíŒì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
        return;
      }
      selectedBoardId = Number(checked.value);
      const board = boards.find(b => b.id === selectedBoardId);
      boardLabel.textContent = `${board?.emoji || ''} ${board?.name || 'ì„ íƒí•œ ê²Œì‹œíŒ'}`;
      boardLabel.classList.remove('text-gray-300');
      boardSheet.classList.remove('active');
    });

    async function submitPost() {
      const title = postTitleInput.value.trim();
      const content = postContentInput.value.trim();
      const nickname = nicknameInput.value.trim() || 'ìµëª…';

      if (!selectedBoardId) {
        postMsg.textContent = 'ê²Œì‹œíŒì„ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.';
        return;
      }
      if (!title || !content) {
        postMsg.textContent = 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
        return;
      }

      postSubmitBtn.disabled = true;
      postMsg.textContent = 'ë“±ë¡ ì¤‘...';

      const { error } = await sb
        .from('posts')
        .insert({ board_id: selectedBoardId, title, content, nickname });

      if (error) {
        console.error(error);
        postMsg.textContent = 'ë“±ë¡ ì‹¤íŒ¨: ' + error.message;
        postSubmitBtn.disabled = false;
        return;
      }

      postMsg.textContent = 'ë“±ë¡ ì™„ë£Œ!';
      postTitleInput.value = '';
      postContentInput.value = '';
      await loadRecentPosts();
      postSubmitBtn.disabled = false;
    }

    postSubmitBtn.addEventListener('click', submitPost);

    async function likePost(postId) {
      const key = 'bsbk_like_' + postId;
      if (localStorage.getItem(key)) return;

      const ipHash = key + '_' + Math.random().toString(36).slice(2);
      const { error } = await sb
        .from('likes')
        .insert({ post_id: postId, ip_hash: ipHash });

      if (error) {
        console.error(error);
        return;
      }
      localStorage.setItem(key, '1');

      await sb
        .rpc('increment_post_like', { post_id_input: postId })
        .catch(()=>{});
      await loadRecentPosts();
    }

    async function addComment(postId) {
      const textarea = document.getElementById('comment-input-' + postId);
      const msgEl = document.getElementById('comment-msg-' + postId);
      const content = textarea.value.trim();
      if (!content) {
        msgEl.textContent = 'ëŒ“ê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
        return;
      }
      const nickname = 'ìµëª…';

      const { error } = await sb
        .from('comments')
        .insert({ post_id: postId, content, nickname });

      if (error) {
        console.error(error);
        msgEl.textContent = 'ë“±ë¡ ì‹¤íŒ¨';
        return;
      }
      textarea.value = '';
      msgEl.textContent = '';
      await loadRecentPosts();
    }

    async function commentsCount(postId) {
      const { count } = await sb
        .from('comments')
        .select('id', { count: 'exact', head: true })
        .eq('post_id', postId);
      return count || 0;
    }

    async function loadRecentPosts() {
      const { data, error } = await sb
        .from('posts')
        .select('id,title,content,created_at,nickname,likes_count,boards(id,name,emoji)')
        .order('created_at', { ascending: false })
        .limit(30);

      if (error) {
        console.error(error);
        return;
      }
      const posts = data || [];
      const counts = await Promise.all(posts.map(p => commentsCount(p.id)));
      postsList.innerHTML = posts.map((p, idx) => {
        const count = counts[idx] || 0;
        const boardName = p.boards?.name || '';
        const emoji = p.boards?.emoji || '';
        const liked = localStorage.getItem('bsbk_like_' + p.id);
        return `
          <article class="bg-[#111] border border-[#222] rounded-2xl p-4">
            <header class="flex justify-between items-start mb-1">
              <div>
                <p class="text-xs text-gray-400 mb-1">${emoji} ${boardName}</p>
                <h4 class="font-semibold text-sm mb-1">${p.title}</h4>
              </div>
              <span class="text-[11px] text-gray-500">
                ${new Date(p.created_at).toLocaleDateString('ko-KR')}
              </span>
            </header>
            <p class="text-sm text-gray-200 whitespace-pre-line mb-3">${p.content}</p>
            <div class="flex items-center justify-between text-xs text-gray-400 mb-2">
              <span>by ${p.nickname || 'ìµëª…'}</span>
              <div class="flex items-center gap-4">
                <button onclick="likePost(${p.id})"
                        class="flex items-center gap-1 ${liked ? 'text-[#ff5252]' : ''}">
                  <i class="fas fa-heart"></i>
                  <span>${p.likes_count || 0}</span>
                </button>
                <span class="flex items-center gap-1">
                  <i class="fas fa-comment-dots"></i>
                  <span>${count}</span>
                </span>
              </div>
            </div>
            <div class="mt-2 border-top border-gray-800 pt-2">
              <textarea id="comment-input-${p.id}" rows="2"
                        class="w-full text-xs px-2 py-1 rounded bg-black border border-gray-700 text-white mb-1"
                        placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
              <div class="flex justify-end items-center gap-2">
                <span id="comment-msg-${p.id}" class="text-[11px] text-gray-400"></span>
                <button class="px-3 py-1 bg-gray-800 text-[11px] rounded"
                        onclick="addComment(${p.id})">
                  ëŒ“ê¸€ ë“±ë¡
                </button>
              </div>
            </div>
          </article>
        `;
      }).join('') || `
        <p class="text-sm text-gray-500">ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      `;
    }

    window.likePost = likePost;
    window.addComment = addComment;

    (async () => {
      await loadBoards();
      await loadRecentPosts();
    })();
  </script>
</body>
</html>
