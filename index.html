<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BSBKTV | ë¦¬ì–¼íƒ€ì„ ë°©ì†¡êµ­</title>

  <!-- ë©”íƒ€ / OG -->
  <meta name="naver-site-verification" content="5ba7f1186b1e87736f411dc503245675bc0bda9f" />
  <meta property="og:title" content="BSBKTV | ë‹¤ì–‘í•œ ì°½ì‘ìì˜ ì¢‹ì€ ì½˜í…ì¸ ë¥¼ í•œê³³ì— ëª¨ì•„ ì„¸ìƒì´ë¼ëŠ” ì°½ì— ë¹„ì¶”ëŠ” ë°©ì†¡êµ­" />
  <meta property="og:description" content="ìœ íŠœë²„, ì‘ê°€, ìŠ¤ë ˆë“œ í¬ë¦¬ì—ì´í„°ì˜ ì½˜í…ì¸ ë¥¼ ëª¨ì•„ ì†Œê°œí•˜ê³  ì—°ê²°í•´ ì£¼ëŠ” íë ˆì´ì…˜ ë°©ì†¡ í”Œë«í¼ì…ë‹ˆë‹¤." />
  <meta property="og:image" content="https://bookoh.github.io/bsbktv/bsbktv-og.png">
  <meta property="og:url" content="https://bookoh.github.io/bsbktv/">

  <!-- GA -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LTYGXJRYKY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-LTYGXJRYKY');
  </script>

  <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- ìŠ¤íƒ€ì¼ -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;500;700;900&display=swap');
    *{box-sizing:border-box;}
    body{
      font-family:'Pretendard',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      background:#050505;color:#fff;
    }
    .neon-text{color:#00E5FF;text-shadow:0 0 15px rgba(0,229,255,0.5);}
    .video-card{
      background:#111;border-radius:16px;overflow:hidden;
      border:1px solid #222;transition:all .25s ease;cursor:pointer;
      min-width:260px;max-width:320px;
    }
    .video-card:hover{
      transform:translateY(-4px);
      border-color:#00E5FF;
      box-shadow:0 8px 24px rgba(0,229,255,0.18);
    }
    .loader{
      border:3px solid #333;border-top:3px solid #00E5FF;
      border-radius:50%;width:34px;height:34px;
      animation:spin 1s linear infinite;margin:40px auto;
    }
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .section-title{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;
    }
    .section-title h2{
      font-size:1.5rem;font-weight:900;
      background:linear-gradient(135deg,#00E5FF,#fff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .badge-live{
      background:#ff1744;color:#fff;font-size:11px;
      padding:4px 10px;border-radius:999px;font-weight:700;
    }
    .board-row{
      background:#111;border-radius:12px;padding:16px;
      border:1px solid #222;transition:all .2s;cursor:pointer;
    }
    .board-row:hover{
      background:#141414;border-color:#00E5FF;transform:translateX(4px);
    }
    .hero-subtitle{
      background:linear-gradient(135deg,#00E5FF,#667eea);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .row-scroll{
      display:flex;gap:16px;overflow-x:auto;
      padding-bottom:6px;-webkit-overflow-scrolling:touch;
      scroll-snap-type:x mandatory;
    }
    .row-scroll::-webkit-scrollbar{height:4px;}
    .row-scroll::-webkit-scrollbar-thumb{
      background:#333;border-radius:999px;
    }
    .row-item{scroll-snap-align:start;}
    .mobile-menu{
      position:fixed;inset:0;background:rgba(0,0,0,0.9);
      backdrop-filter:blur(10px);z-index:60;display:none;
    }
    .mobile-menu.active{display:block;}

    /* SPA ë¼ìš°íŒ… */
    .page-section{display:none;}
    .page-section.active{display:block;}

    .board-form{display:block;}
  </style>
</head>

<body class="min-h-screen">
  <!-- ëª¨ë°”ì¼ ë©”ë‰´ -->
  <div id="mobile-menu" class="mobile-menu">
    <div class="max-w-7xl mx-auto px-4 pt-6 flex justify-between items-center">
      <span class="text-2xl font-black">BSBK<span class="neon-text">TV</span></span>
      <button onclick="toggleMobileMenu(false)" class="p-2 text-gray-300">
        <i class="fas fa-times text-2xl"></i>
      </button>
    </div>
    <div class="mt-8 px-6 space-y-8">
      <div class="bg-[#111] border border-[#222] rounded-2xl p-5">
        <p class="text-sm text-[#00E5FF] font-semibold mb-2">WELCOME TO BSBKTV</p>
        <p class="text-sm leading-relaxed text-gray-200">
          ì—¬ê¸°ì„œëŠ” ì•Œê³ ë¦¬ì¦˜ì´ ì•„ë‹ˆë¼ í¸ì„± ë””ë ‰í„°ê°€ ê²°ì •í•©ë‹ˆë‹¤.<br>
          ì˜¤ëŠ˜ í•˜ë£¨, ë‹¹ì‹ ì˜ ì‹œê°„ì„ ì¨ë³¼ ë§Œí•œ ì˜ìƒê³¼ ì´ì•¼ê¸°ë§Œ ì—„ì„ í•´ì„œ ë‚´ë³´ëƒ…ë‹ˆë‹¤.
        </p>
      </div>

      <nav class="space-y-4 text-lg">
        <a href="?" class="block text-white font-semibold">ğŸ¬ BSBKTV TOP 10</a>
        <a href="?page=categories" class="block text-gray-200">ğŸ“º ì¹´í…Œê³ ë¦¬ í¸ì„±í‘œ</a>
        <a href="?page=notices" class="block text-gray-200">ğŸ“¢ ê³µì§€ì‚¬í•­</a>
        <a href="?page=community" class="block text-gray-200">ğŸ’¬ ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="?page=qa" class="block text-gray-200">â“ Q&A</a>
        <a href="?page=audiobook" class="block text-gray-200">ğŸ§ AI ì˜¤ë””ì˜¤ë¶</a>
        <a href="?page=upictune" class="block text-gray-200">ğŸµ ìœ í”½íŠ  AI ë®¤ì§</a>
        <a href="?page=sponsor" class="block text-gray-200">ğŸ§· ìŠ¤í°ì„œ ì•ˆë‚´</a>
      </nav>

      <div class="mt-8 grid grid-cols-3 gap-3 text-xs">
        <a href="mailto:maple3589@gmail.com"
           class="flex flex-col items-center justify-center rounded-xl py-3 bg-gradient-to-b from-[#00E5FF] to-[#007F8C] text-black font-semibold">
          <i class="fas fa-handshake mb-1"></i>
          í˜‘ì—… ë¬¸ì˜
        </a>
        <a href="mailto:maple3589@gmail.com"
           class="flex flex-col items-center justify-center rounded-xl py-3 bg-gradient-to-b from-[#FFEA00] to-[#FF9800] text-black font-semibold">
          <i class="fas fa-ad mb-1"></i>
          ìŠ¤í°ì„œ
        </a>
        <a href="https://www.threads.net/@bookoh" target="_blank" rel="noopener noreferrer"
           class="flex flex-col items-center justify-center rounded-xl py-3 bg-gradient-to-b from-[#7C4DFF] to-[#311B92] text-white font-semibold">
          <i class="fab fa-threads mb-1"></i>
          ìŠ¤ë ˆë“œ
        </a>
      </div>
    </div>
  </div>

  <!-- í—¤ë” -->
  <header class="fixed top-0 inset-x-0 bg-black/95 backdrop-blur-xl z-50 border-b border-gray-800/50">
    <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <span class="text-3xl font-black tracking-tighter">BSBK<span class="neon-text">TV</span></span>
        <span class="badge-live flex items-center gap-1">
          <span class="w-2 h-2 rounded-full bg-white animate-pulse"></span>
          ON AIR
        </span>
      </div>
      <nav class="hidden lg:flex items-center gap-6 text-sm text-gray-300">
        <a href="?" class="hover:text-white">TOP10</a>
        <a href="?page=categories" class="hover:text-white">ì¹´í…Œê³ ë¦¬ í¸ì„±</a>
        <a href="?page=notices" class="hover:text-white">ê³µì§€ì‚¬í•­</a>
        <a href="?page=community" class="hover:text-white">ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="?page=qa" class="hover:text-white">Q&A</a>
        <a href="?page=sponsor" class="hover:text-white">ìŠ¤í°ì„œ ì•ˆë‚´</a>
      </nav>
      <div class="flex items-center gap-3">
        <a href="mailto:maple3589@gmail.com"
           class="hidden md:block bg-gradient-to-r from-[#00E5FF] to-[#667eea] text-black text-xs font-bold px-6 py-2 rounded-full transition-all hover:scale-105 shadow-lg">
          <i class="fas fa-broadcast-tower mr-1"></i>ì…ì  ë¬¸ì˜
        </a>
        <button class="lg:hidden p-2 text-gray-400 hover:text-white" onclick="toggleMobileMenu(true)">
          <i class="fas fa-bars text-xl"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- ë©”ì¸ -->
  <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto">
    <!-- í™ˆ íˆì–´ë¡œ + TOP10 + ì¹´í…Œê³ ë¦¬ + ì¹˜ì§€ì§ + ì˜¤ë””ì˜¤ë¶ + ìœ í”½íŠ  -->
    <section id="home-hero" class="page-section mb-12">
      <h1 class="text-5xl md:text-6xl font-black tracking-tight mb-6 text-center">
        BSBK<span class="neon-text">TV</span>
      </h1>
      <p class="hero-subtitle text-xl md:text-2xl mb-8 max-w-2xl mx-auto leading-relaxed text-center">
        ë‹¤ì–‘í•œ ì°½ì‘ìì˜ ì¢‹ì€ ì½˜í…ì¸ ë“¤ì„ í•œê³³ì— ëª¨ì•„ ì„¸ìƒì´ë¼ëŠ” ì°½ì— ë¹„ì¶”ëŠ” ë°©ì†¡êµ­.
      </p>
    </section>

    <div id="loader" class="loader hidden"></div>

    <section id="top10-section" class="page-section mb-12">
      <div class="section-title">
        <h2>ğŸ¬ BSBKTV TOP 10</h2>
      </div>
      <div id="top10-container" class="row-scroll"></div>
    </section>

    <section id="categories-section" class="page-section">
      <div id="sections-container"></div>
    </section>

    <section id="chzzk-section" class="page-section mt-16 max-w-5xl mx-auto px-4">
      <div class="section-title">
        <h2>ğŸ“º BSBKTV ì¹˜ì§€ì§ ë¼ì´ë¸Œ</h2>
      </div>
      <div class="rounded-2xl border border-white/10 bg-transparent p-4 flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
        <div>
          <p class="text-xs text-[#00E5FF] font-semibold mb-1">LIVE ON CHZZK</p>
          <p class="text-sm text-gray-300">
            BSBKTV ì‹¤ì‹œê°„ ë¼ì´ë¸Œ ë°©ì†¡ì€ ì¹˜ì§€ì§ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤.
          </p>
          <p class="text-xs text-gray-500 mt-1">
            í¸ì„± ë””ë ‰í„°ì™€ í•¨ê»˜í•˜ëŠ” ë¼ì´ë¸Œ í¸ì„±, AI ì˜ìƒ ì œì‘ ë¹„í•˜ì¸ë“œ ë“±.
          </p>
        </div>
        <a href="https://chzzk.naver.com/live/f22798612d8f1ecf32c0f51e381d12a7"
           target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center justify-center px-5 py-2.5 rounded-full
                  bg-[#00E5FF] text-black text-xs font-bold hover:brightness-110 transition">
          BSBKTV ì¹˜ì§€ì§ ë¼ì´ë¸Œ ë³´ëŸ¬ê°€ê¸°
        </a>
      </div>
    </section>

    <section id="audiobook-section" class="page-section mt-16 max-w-5xl mx-auto px-4">
      <div class="section-title">
        <h2>ğŸ“– AI ì˜¤ë””ì˜¤ë¶</h2>
      </div>
      <p class="text-sm text-gray-400 mb-6">
        AIê°€ ì½ì–´ì£¼ëŠ” ì˜¤ë””ì˜¤ë¶ì…ë‹ˆë‹¤.
      </p>
      <div id="audiobooks" class="row-scroll"></div>
    </section>

    <section id="upictune-section" class="page-section mt-16 max-w-5xl mx-auto px-4">
      <div class="section-title">
        <h2>ğŸµ ìœ í”½íŠ  : AI ë®¤ì§</h2>
      </div>
      <p class="text-sm text-gray-400 mb-6">
        AIë¡œ ë§Œë“  í…Œë§ˆê³¡ê³¼ ì‚¬ìš´ë“œíŠ¸ë™ì„ ìœ í”½íŠ ì—ì„œ ë“¤ì–´ë³´ì„¸ìš”.
      </p>
      <div id="upictune-list" class="row-scroll"></div>
    </section>

    <!-- ê°œë³„ í˜ì´ì§€: ê³µì§€ / ì»¤ë®¤ë‹ˆí‹° / Q&A / ìŠ¤í°ì„œ (í™ˆì—ì„œëŠ” ìˆ¨ê¹€) -->
    <section id="notices-section" class="page-section mt-16">
      <div class="section-title"><h2>ğŸ“¢ ê³µì§€ì‚¬í•­</h2></div>
      <div id="notices-container" class="space-y-3"></div>
    </section>

    <section id="community-section" class="page-section mt-16">
      <div class="section-title"><h2>ğŸ’¬ ììœ ê²Œì‹œíŒ</h2></div>
      <div id="freeboard-container" class="space-y-3 mb-8"></div>
      <div class="board-form bg-[#111] border border-[#222] rounded-2xl p-6">
        <h3 class="text-lg font-bold mb-4 text-[#00E5FF]">ê¸€ ì‘ì„±</h3>
        <form id="board-form">
          <input id="board-title" type="text" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                 class="w-full bg-[#1a1a1a] border border-[#333] rounded-lg px-4 py-3 text-white mb-4 text-sm focus:outline-none focus:border-[#00E5FF]">
          <textarea id="board-content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" rows="5"
                    class="w-full bg-[#1a1a1a] border border-[#333] rounded-lg px-4 py-3 text-white mb-4 text-sm focus:outline-none focus:border-[#00E5FF]"></textarea>
          <button type="button"
                  class="w-full bg-gradient-to-r from-[#00E5FF] to-[#667eea] text-black font-bold py-3 rounded-lg hover:brightness-110 transition">
            ì‘ì„±í•˜ê¸°
          </button>
        </form>
        <p id="board-message" class="mt-3 text-sm text-[#00E5FF]"></p>
      </div>
    </section>

    <section id="qa-section" class="page-section mt-16">
      <div class="section-title"><h2>â“ Q&A</h2></div>
      <div id="qa-container" class="space-y-3"></div>
    </section>

    <section id="sponsor-section" class="page-section mt-16 max-w-5xl mx-auto px-4">
      <div class="section-title">
        <h2>ğŸ§· ìŠ¤í°ì„œ ê´‘ê³  ì•ˆë‚´</h2>
      </div>
      <p class="text-sm text-gray-400 mb-4">
        BSBKTVì™€ í•¨ê»˜í•  ìŠ¤í°ì„œë¥¼ ëª¨ì§‘í•©ë‹ˆë‹¤. ë°©ì†¡ ë‚´ PPL, ë°°ë„ˆ, ì „ìš© ì½”ë„ˆ ë“± ë‹¤ì–‘í•œ í˜•íƒœë¡œ í˜‘ì—… ê°€ëŠ¥í•©ë‹ˆë‹¤.
      </p>
      <div class="bg-[#111] border border-[#222] rounded-2xl p-6 space-y-3">
        <p class="text-sm text-gray-300">
          Â· ë©”ì¼ë¡œ ê°„ë‹¨í•œ ì†Œê°œì™€ ì›í•˜ëŠ” ìº í˜ì¸ ë‚´ìš©ì„ ë³´ë‚´ ì£¼ì„¸ìš”.<br>
          Â· í¸ì„± ë””ë ‰í„°ê°€ ì§ì ‘ ê²€í†  í›„ ê°œë³„ ì—°ë½ì„ ë“œë¦½ë‹ˆë‹¤.
        </p>
        <p class="text-sm text-[#00E5FF]">
          ë¬¸ì˜ : maple3589@gmail.com
        </p>
      </div>
    </section>
    <!-- ê²Œì‹œê¸€ ìƒì„¸ ëª¨ë‹¬ -->
  <div id="post-modal"
       class="fixed inset-0 bg-black/70 z-50 hidden items-center justify-center px-4">
    <div class="max-w-md w-full bg-[#111] border border-[#222] rounded-2xl p-5 relative">
      <button id="post-modal-close"
              class="absolute top-3 right-3 text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
      <p id="post-modal-type"
         class="text-[11px] text-[#00E5FF] font-semibold mb-1"></p>
      <h3 id="post-modal-title"
          class="text-lg font-bold mb-2"></h3>
      <p id="post-modal-date"
         class="text-[11px] text-gray-500 mb-3"></p>
      <div id="post-modal-content"
           class="text-sm text-gray-200 leading-relaxed whitespace-pre-line"></div>
    </div>
  </div>
  </main>

  <!-- í”Œë ˆì´ì–´ ì˜¤ë²„ë ˆì´ -->
  <div id="player-overlay" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center">
    <div class="relative max-w-4xl w-full mx-4">
      <button onclick="closePlayer()" class="absolute -top-12 left-0 text-2xl text-white z-10">
        <i class="fas fa-times"></i>
      </button>
      <iframe id="player-iframe" class="w-full h-[60vh] md:h-[70vh] rounded-2xl" frameborder="0" allowfullscreen></iframe>
    </div>
  </div>

  <!-- í‘¸í„° -->
  <footer class="bg-black/80 border-t border-gray-800 py-10 mt-24">
    <div class="max-w-7xl mx-auto px-4 text-gray-400 text-sm space-y-4">
      <div class="flex flex-col items-center gap-4">
        <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 text-xs">
          <a href="terms.pdf" target="_blank" class="hover:text-[#00E5FF] transition">ì´ìš©ì•½ê´€</a>
          <a href="privacy.pdf" target="_blank" class="hover:text-[#00E5FF] transition">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
          <a href="?page=sponsor" class="hover:text-[#00E5FF] transition">ìŠ¤í°ì„œ ì•ˆë‚´</a>
          <a href="?" class="hover:text-[#00E5FF] transition">í™ˆ</a>
        </div>
        <div class="text-center text-xs">
          <p>BSBKTV Â© 2025. All rights reserved.</p>
          <p class="mt-1">ë¬¸ì˜: maple3589@gmail.com</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ë³´í˜¸
    document.addEventListener('contextmenu',e=>e.preventDefault());
    document.addEventListener('keydown',e=>{
      if(e.key==='F12'||(e.ctrlKey&&(e.key==='U'||e.key==='S'))) e.preventDefault();
    });

    // Supabase
    const { createClient } = supabase;
    const SUPABASE_URL = 'https://dmjaxhydwaumhujrculd.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtamF4aHlkd2F1bWh1anJjdWxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MTEyNTgsImV4cCI6MjA4MDI4NzI1OH0.nTdfW9Iw3OLyYbWcPGU2T8P_i-9tDeqUn1t2cAsIbn0';
    const db = createClient(SUPABASE_URL, SUPABASE_KEY);  /* [web:42] */

    const THREAD_RECOMMENDED_URLS = [
      'https://youtu.be/4Ux6KUF77fA',
      'https://youtu.be/BbMkoRuxLqc',
      'https://youtu.be/vYSsPeHKmP8',
      'https://youtu.be/_VR9N2HN8Ik',
      'https://youtu.be/yw7FkHo6_qQ',
      'https://youtu.be/crHHvBDi698',
      'https://youtu.be/D1JNCyvPvzo'
    ];

    const CATEGORIES = [
      { key:'k-variety', label:'í•œêµ­ì˜ˆëŠ¥', spotTypes:['ë¨¹ë°©','ì˜ˆëŠ¥/í† í¬'] },
      { key:'news',      label:'ë‰´ìŠ¤',     spotTypes:['ë‰´ìŠ¤','ì‹œì‚¬Â·ê²½ì œ'] },
      { key:'ytlive',    label:'ìœ íŠœë¸Œ ë¼ì´ë¸Œ', spotTypes:['ìœ íŠœë¸Œ ë¼ì´ë¸Œ'] },
      { key:'today',     label:'ì˜¤ëŠ˜ì˜ ë°œê²¬', spotTypes:['ì˜¤ëŠ˜ì˜ ë°œê²¬','ê²½ì œÂ·í…Œí¬','AI/ì½˜í…ì¸ '] },
      { key:'k-movie',   label:'í•œêµ­ì˜í™”', spotTypes:['ì˜í™”'] },
      { key:'smallbiz',  label:'ì†Œìƒê³µì¸', spotTypes:['ì†Œìƒê³µì¸'] },
      { key:'writer',    label:'ì‘ê°€',     spotTypes:['ë¶í† í¬/ë‚­ë…'] },
      { key:'ai-video',  label:'AI ì˜ìƒ',  spotTypes:['AI/ì½˜í…ì¸ '] },
      { key:'threads',   label:'ìŠ¤ë ˆë“œ ì¶”ì²œ ìœ íŠœë²„', spotTypes:['ìŠ¤ë ˆë“œ ì¶”ì²œ ìœ íŠœë²„'] }
    ];

    const SLOT_TYPES_BY_CATEGORY = { writer:'writer', today:'today' };

    function affiliateButtonsHtml(spot, slotType) {
      if (!spot.affiliate_buttons || !spot.affiliate_buttons.length) return '';
      const filtered = slotType
        ? spot.affiliate_buttons.filter(b => (b.slot_type || 'writer') === slotType)
        : spot.affiliate_buttons;
      if (!filtered.length) return '';
      return `
        <div class="mt-2 px-4 pb-4 space-y-2">
          <p class="text-[10px] text-gray-500 text-center">
            ${filtered[0]?.provider === 'oliveyoung'
              ? 'í•´ë‹¹ ë§í¬ëŠ” ì˜¬ë¦¬ë¸Œì˜ ì œíœ´ ë§í¬ë¡œ, êµ¬ë§¤ ì‹œ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.'
              : 'ì´ ë§í¬ë¥¼ í†µí•´ êµ¬ë§¤ ì‹œ, ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ìœ¼ë¡œ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.'}
          </p>
          ${filtered.map(btn => `
            <button
              class="w-full flex items-center justify-center gap-2 rounded-full py-2 text-xs font-semibold
                     bg-gradient-to-r from-orange-500 to-blue-600 hover:brightness-110 transition"
              onclick="handleAffiliateClick(${btn.id}, '${btn.url.replace(/'/g,"\\'")}', '${btn.provider}')"
            >
              ${btn.logo_url ? `<img src="${btn.logo_url}" class="h-4 w-4 object-contain" alt="">` : ''}
              <span>${btn.label}</span>
            </button>
          `).join('')}
        </div>
      `;
    }

    function cardHtml(spot, slotTypeForThisCategory){
      const dateStr = spot.created_at
        ? new Date(spot.created_at).toLocaleDateString('ko-KR')
        : '';
      const badge = spot.is_top10
        ? `<span class="badge-live px-2 py-1 text-xs">TOP ${spot.top10_rank ?? ''}</span>`
        : '';
      const affiliateHtml = affiliateButtonsHtml(spot, slotTypeForThisCategory);

      return `
        <div class="row-item">
          <div class="video-card block" onclick='openPlayer(${JSON.stringify({
            id: spot.id,
            video_url: spot.video_url
          }).replace(/'/g, "\\'")})'>
            <div class="aspect-video overflow-hidden relative">
              <img src="${spot.thumb_url}" alt="${spot.name}"
                   class="w-full h-full object-cover hover:scale-105 transition">
              <div class="absolute top-2 right-2">
                ${badge}
              </div>
            </div>
            <div class="p-4 pb-2">
              <h3 class="font-bold text-sm leading-tight line-clamp-2 mb-2">${spot.name}</h3>
              <div class="flex items-center text-xs text-gray-500 gap-3">
                <span>${spot.type ?? ''}</span>
                <span>${dateStr}</span>
              </div>
            </div>
            ${affiliateHtml}
          </div>
        </div>
      `;
    }

    async function handleAffiliateClick(buttonId, url, provider){
      try{
        await db.from('affiliate_clicks').insert({
          button_id: buttonId,
          provider,
          clicked_at: new Date().toISOString()
        });
      }catch(e){
        console.error(e);
      }
      window.open(url, '_blank');
    }

    async function loadNotices(){
      const { data,error } = await db
        .from('notices')
        .select('id,title,content,created_at')
        .order('created_at',{ascending:false})
        .limit(5);
      if(error) console.error(error);
      else displayBoard('notices-container',data||[],'ê³µì§€');
    }

    async function loadFreeBoard(){
      const { data,error } = await db
        .from('board')
        .select('id,title,content,created_at')
        .order('created_at',{ascending:false})
        .limit(5);
      if(error) console.error(error);
      else displayBoard('freeboard-container',data||[],'ììœ ê²Œì‹œíŒ');
    }

    async function loadQA(){
      const { data,error } = await db
        .from('qa')
        .select('id,title,content,created_at')
        .order('created_at',{ascending:false})
        .limit(5);
      if(error) console.error(error);
      else displayBoard('qa-container',data||[],'Q&A');
    }

    async function loadVideos(){
      const { data,error } = await db
        .from('spots')
        .select('*, affiliate_buttons(*)')
        .order('created_at',{ascending:false});
      if(error){ console.error(error); return; }

      const spots = data || [];
      const topSpots = spots
        .filter(s => s.is_top10 === true)
        .sort((a,b)=>(a.top10_rank||999)-(b.top10_rank||999))
        .slice(0,10);
      displayTop10(topSpots);

      window.__allSpots = spots;
      renderCategorySections();
    }

    function displayTop10(spots){
      const container = document.getElementById('top10-container');
      container.innerHTML = '';
      if(!spots || spots.length===0){
        container.innerHTML = '<div class="text-gray-500 text-sm py-6">ë“±ë¡ëœ TOP 10 ë°©ì†¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      container.innerHTML = spots.map(s => cardHtml(s, null)).join('');
    }

    function renderCategorySections(){
      const container = document.getElementById('sections-container');
      const spots = window.__allSpots || [];

      container.innerHTML = CATEGORIES.map(cat=>{
        let catSpots;
        if(cat.key==='threads'){
          catSpots = spots.filter(s =>
            (s.type==='ìŠ¤ë ˆë“œ ì¶”ì²œ ìœ íŠœë²„') ||
            THREAD_RECOMMENDED_URLS.includes((s.video_url||'').trim())
          );
        }else{
          catSpots = spots.filter(s => (cat.spotTypes||[]).includes(s.type));
        }
        if(!catSpots.length) return '';

        const slotType = SLOT_TYPES_BY_CATEGORY[cat.key] || null;
        const cardsHtml = catSpots.map(s => cardHtml(s, slotType)).join('');

        const isWriter = cat.key === 'writer';
        const isToday  = cat.key === 'today';

        return `
          <section class="mt-10">
            <div class="section-title">
              <h2>${cat.label}</h2>
            </div>

            ${isWriter ? `
              <p class="text-[11px] text-gray-500 mb-1">
                ì´ í¬ìŠ¤íŒ…ì€ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, ì´ì— ë”°ë¥¸ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
              </p>
              <p class="text-[11px] text-gray-500 mb-2">
                ì´ í¬ìŠ¤íŒ…ì€ ì˜¬ë¦¬ë¸Œì˜ ì‡¼í•‘ íë ˆì´í„° í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, êµ¬ë§¤ ì‹œ ì¼ì • ê¸ˆì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
              </p>
            ` : ''}

            ${isToday ? `
              <p class="text-[11px] text-gray-500 mb-1">
                ì´ í¬ìŠ¤íŒ…ì€ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, ì´ì— ë”°ë¥¸ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
              </p>
              <p class="text-[11px] text-gray-500 mb-2">
                ì´ í¬ìŠ¤íŒ…ì€ ì˜¬ë¦¬ë¸Œì˜ ì‡¼í•‘ íë ˆì´í„° í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, êµ¬ë§¤ ì‹œ ì¼ì • ê¸ˆì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
              </p>
            ` : ''}

            <div class="row-scroll">
              ${cardsHtml}
            </div>
          </section>
        `;
      }).join('');
    }

    function extractYouTubeId(url) {
      if (!url) return null;
      try {
        if (url.includes('youtu.be/')) {
          return url.split('youtu.be/')[1].split(/[?&]/)[0];
        }
        const u = new URL(url);
        if (u.searchParams.get('v')) {
          return u.searchParams.get('v');
        }
        if (url.includes('/embed/')) {
          return url.split('/embed/')[1].split(/[?&]/)[0];
        }
      } catch (e) {
        console.error('extractYouTubeId error', e);
      }
      return null;
    }

    function openPlayer(spot) {
      const videoId = extractYouTubeId(spot.video_url || '');
      if (!videoId) {
        console.error('Invalid video_url', spot.video_url);
        return;
      }
      const player = document.getElementById('player-iframe');
      player.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;

      const overlay = document.getElementById('player-overlay');
      overlay.classList.remove('hidden');
      overlay.classList.add('flex');
    }

    function closePlayer() {
      const overlay = document.getElementById('player-overlay');
      const player = document.getElementById('player-iframe');
      overlay.classList.add('hidden');
      overlay.classList.remove('flex');
      player.src = '';
    }

    function displayBoard(containerId,items,boardType){
      const container = document.getElementById(containerId);
      container.innerHTML =
        (items||[]).map(item=>`
          <div class="board-row group"
               onclick='openPostModal(${JSON.stringify(item).replace(/'/g,"\\'")}, "${boardType}")'>
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-bold text-sm line-clamp-1 group-hover:text-[#00E5FF]">${item.title}</h4>
              <span class="text-xs text-gray-500">
                ${item.created_at ? new Date(item.created_at).toLocaleDateString('ko-KR') : ''}
              </span>
            </div>
            <p class="text-xs text-gray-400 line-clamp-2">${item.content}</p>
          </div>
        `).join('') ||
        `<div class="text-center py-12 text-gray-500">ì•„ì§ ${boardType} ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    }

    function openPostModal(item, boardType) {
      const modal = document.getElementById('post-modal');
      if (!modal) return;

      document.getElementById('post-modal-type').textContent = boardType;
      document.getElementById('post-modal-title').textContent = item.title || '';
      document.getElementById('post-modal-date').textContent =
        item.created_at
          ? new Date(item.created_at).toLocaleString('ko-KR')
          : '';
      document.getElementById('post-modal-content').textContent = item.content || '';

      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function closePostModal() {
      const modal = document.getElementById('post-modal');
      if (!modal) return;
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }

    function toggleMobileMenu(open){
      const menu = document.getElementById('mobile-menu');
      if(open) menu.classList.add('active');
      else menu.classList.remove('active');
    }

    async function loadAudiobooks() {
  const box = document.getElementById('audiobooks');
  if (!box) return;

  try {
    const { data, error } = await db
      .from('videos')
      .select('id,title,description,url,category')
      .eq('category', 'audiobook')
      .not('url', 'is', null);

    if (error) {
      box.innerHTML = '<p style="color:red">ì˜¤ë””ì˜¤ë¶ ë¡œë“œ ì—ëŸ¬: ' + error.message + '</p>';
      return;
    }
    if (!data || !data.length) {
      box.innerHTML = '<p style="color:gray">ë“±ë¡ëœ ì˜¤ë””ì˜¤ë¶ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }

    box.innerHTML = data.map(v => `
      <div class="row-item min-w-[260px] max-w-[280px] p-4 rounded-lg border border-[#00E5FF]/40 bg-transparent">
        <h3 class="font-semibold text-white mb-2 line-clamp-1">${v.title}</h3>
        <audio controls preload="none" class="w-full mb-2 bg-transparent">
          <source src="${v.url}" type="audio/mpeg">
          ë¸Œë¼ìš°ì €ì—ì„œ ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
        </audio>
        <p class="text-gray-400 text-sm line-clamp-2">${v.description || ''}</p>
      </div>
    `).join('');
  } catch (e) {
    box.innerHTML = '<p style="color:red">ì˜¤ë””ì˜¤ë¶ ì˜ˆì™¸ ë°œìƒ: ' + e.message + '</p>';
  }
    }

    async function loadUpictuneTracks() {
      try {
        const { data, error } = await db
          .from('music_tracks')
          .select('*')
          .eq('is_public', true)
          .order('id', { ascending: false });
        const box = document.getElementById('upictune-list');
        if (error) {
          box.innerHTML = '<p style="color:red">ìœ í”½íŠ  ë¡œë“œ ì—ëŸ¬</p>';
          return;
        }
        if (!data || !data.length) {
          box.innerHTML = '<p style="color:gray">ìœ í”½íŠ  ë°ì´í„° ì•„ì§ ì—†ìŒ</p>';
          return;
        }
        box.innerHTML = data.map(v => `
          <div class="row-item min-w-[260px] max-w-[280px] p-4 rounded-lg border border-[#00E5FF]/40 bg-transparent">
            <h3 class="font-semibold text-white mb-2 line-clamp-1">${v.title}</h3>
            <audio controls class="w-full mb-2 bg-transparent">
              <source src="${v.audio_url}" type="audio/mpeg">
            </audio>
            <p class="text-gray-400 text-sm line-clamp-2">${v.description || ''}</p>
          </div>
        `).join('');
      } catch (e) {
        document.getElementById('upictune-list').innerHTML =
          '<p style="color:red">ìœ í”½íŠ  ì˜ˆì™¸ ë°œìƒ</p>';
      }
    }

    // ììœ ê²Œì‹œíŒ ì‘ì„±
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('board-form');
      if (!form) return;

      const titleInput   = document.getElementById('board-title');
      const contentInput = document.getElementById('board-content');
      const button       = form.querySelector('button');
      const message      = document.getElementById('board-message');

      // ê¸€ ì‘ì„± ë²„íŠ¼
      button.addEventListener('click', async () => {
        const title   = titleInput.value.trim();
        const content = contentInput.value.trim();

        if (!title || !content) {
          message.textContent = 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
          return;
        }

        button.disabled = true;
        message.textContent = 'ì‘ì„± ì¤‘...';

        const { error } = await db.from('board').insert({ title, content });
        if (error) {
          message.textContent = 'ì‘ì„± ì‹¤íŒ¨: ' + error.message;
          button.disabled = false;
          return;
        }

        message.textContent = 'ì‘ì„± ì™„ë£Œ!';
        titleInput.value = '';
        contentInput.value = '';
        button.disabled = false;

        loadFreeBoard();
      });

      // ê²Œì‹œê¸€ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸
      const modal    = document.getElementById('post-modal');
      const closeBtn = document.getElementById('post-modal-close');

      if (closeBtn) {
        closeBtn.addEventListener('click', closePostModal);
      }
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closePostModal();
        });
      }
    });

    // SPA ë¼ìš°íŒ…
    function showPage(page) {
      const sections = {
        home: ['home-hero','top10-section','categories-section','chzzk-section','audiobook-section','upictune-section'],
        categories: ['categories-section','chzzk-section'],
        notices: ['notices-section'],
        community: ['community-section'],
        qa: ['qa-section'],
        audiobook: ['audiobook-section'],
        upictune: ['upictune-section'],
        sponsor: ['sponsor-section']
      };
      document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
      (sections[page] || sections.home).forEach(id=>{
        const el = document.getElementById(id);
        if (el) el.classList.add('active');
      });
    }

    window.addEventListener('load', async () => {
      const loader = document.getElementById('loader');
      if (loader) loader.style.display = 'block';

      const params = new URLSearchParams(location.search);
      const page = params.get('page') || 'home';
      showPage(page);

      try {
        await Promise.all([
          loadVideos(),
          loadNotices(),
          loadFreeBoard(),
          loadQA(),
          loadAudiobooks(),
          loadUpictuneTracks()
        ]);
      } catch(e){ console.error(e); }
      finally{ if (loader) loader.style.display='none'; }

      document.querySelectorAll('a[href^="?"]').forEach(link=>{
        link.addEventListener('click',e=>{
          e.preventDefault();
          const href = link.getAttribute('href');
          history.pushState({},'',href);
          const p = new URLSearchParams(href.split('?')[1]).get('page') || 'home';
          showPage(p);
          toggleMobileMenu(false);
        });
      });
    });

    window.addEventListener('popstate',()=>{
      const params = new URLSearchParams(location.search);
      const page = params.get('page') || 'home';
      showPage(page);
    });
  </script>
</body>
</html>
