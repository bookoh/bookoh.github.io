<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>BSBKTV · AI 뮤직 재생</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="bsbktv.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-client.js"></script>
</head>
<body>
  <header class="header">
    <h1>AI 뮤직</h1>
    <a href="./music.html" class="link-home">목록으로</a>
  </header>

  <main id="music-detail" class="detail">로딩 중...</main>

  <script>
    const detailEl = document.getElementById('music-detail');

    function getIdFromQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    async function loadTrack() {
      const id = getIdFromQuery();
      if (!id) {
        detailEl.textContent = 'ID가 없습니다.';
        return;
      }

      const { data, error } = await db
        .from('music_tracks')
        .select('*')
        .eq('id', id)
        .maybeSingle();

      if (error || !data) {
        console.error(error);
        detailEl.textContent = '트랙 정보를 불러오는 데 실패했습니다.';
        return;
      }

      const track = data;
      const cover = track.cover_url || '';
      const desc = track.description || '';
      const dur = track.duration ? `${track.duration}초` : '길이 정보 없음';

      detailEl.innerHTML = `
        <article class="detail-card">
          ${cover ? `<img src="${cover}" alt="${track.title}" class="detail-cover" />` : ''}
          <h2 class="detail-title">${track.title}</h2>
          <p class="detail-meta">
            장르: ${track.genre || '기타'} · 아티스트: ${track.artist || '알 수 없음'} · 길이: ${dur}
          </p>
          ${desc ? `<p class="detail-desc">${desc}</p>` : ''}
          ${track.audio_url
            ? `<audio controls class="detail-audio" src="${track.audio_url}"></audio>`
            : `<p>오디오 URL이 아직 등록되지 않았습니다.</p>`}
        </article>
      `;
    }

    loadTrack();
  </script>
</body>
</html>
