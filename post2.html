<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>테스트 글</title>
</head>
<body>
  <div id="post">로딩 중...</div>

  <!-- Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- 메인 스크립트 -->
  <script>
    async function main() {
      const box = document.getElementById('post');

      // 1) URL 파라미터에서 id 읽기
      const params = new URLSearchParams(window.location.search);
      const postIdRaw = params.get('id');
      const postId = parseInt(postIdRaw || '0', 10);
      box.textContent = '[STEP1] raw=' + postIdRaw + ', parsed=' + postId;

      // 2) supabase 로딩 확인
      if (!window.supabase) {
        box.textContent += '\n[ERROR] supabase not loaded';
        return;
      }

      // 3) supabase 클라이언트 생성 (두 번째 인자는 anon public key)
      const supa = window.supabase.createClient(
        'https://dmjaxyhdwaumhujrculd.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtamF4aHlkd2F1bWh1anJjdWxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MTEyNTgsImV4cCI6MjA4MDI4NzI1OH0.nTdfW9Iw3OLyYbWcPGU2T8P_i-9tDeqUn1t2cAsIbn0'
      );

      box.textContent += '\n[STEP2] client ok';

      // 4) posts 테이블에서 한 줄 가져오기
      const { data, error } = await supa
        .from('posts')
        .select('title')
        .eq('id', postId)
        .maybeSingle();

      if (error) {
        box.textContent += '\n[STEP3] error: ' + error.message;
      } else if (!data) {
        box.textContent += '\n[STEP3] no row';
      } else {
        box.textContent += '\n[STEP3] title: ' + data.title;
      }
    }

    main();
  </script>
</body>
</html>
