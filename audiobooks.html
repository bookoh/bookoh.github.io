<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>오디오북</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-client.js"></script> <!-- 여기에 createClient 코드만 들어있는 파일 -->
</head>
<body>
  <header>
    <h1>오디오북</h1>
  </header>

  <section id="audiobook-list">
    오디오북 불러오기 실패
  </section>

  <script>
    // supabase-client.js 안에 아래처럼 전역 db 만들어놨다고 가정
    // const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function loadAudiobooks() {
      const listEl = document.getElementById('audiobook-list');

      const { data, error } = await db
        .from('videos')                      // 테이블 이름: videos
        .select('*')
        .eq('category', 'audiobook')         // 오디오북만
        .order('created_at', { ascending: false });

      if (error) {
        console.error(error);
        listEl.textContent = '오디오북 불러오기 실패';
        return;
      }

      if (!data || data.length === 0) {
        listEl.textContent = '등록된 오디오북이 없습니다.';
        return;
      }

      listEl.innerHTML = '';

      data.forEach((item) => {
        const div = document.createElement('div');
        div.className = 'audiobook-item';

        div.innerHTML = `
          <h2>${item.title ?? ''}</h2>
          <p>${item.description ?? ''}</p>
          ${item.url ? `<audio controls src="${item.url}"></audio>` : ''}
        `;

        listEl.appendChild(div);
      });
    }

    loadAudiobooks();
  </script>
</body>
</html>
